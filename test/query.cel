DECLARE EVENT T(temp double, id int)
DECLARE EVENT H(income int, cost int, id int)
DECLARE STREAM S(T, H)
DECLARE STREAM S2(T)

SELECT MAX *
FROM S, S2
WHERE ( S>T ; H + ; T AS t2 ) AS all_events
FILTER
    all_events[id NOT IN { 123, 125 }]
    AND
    ( t2[temp > 50 or temp < 20] OR H[income > 2 * cost] )
PARTITION BY
    [id]
WITHIN 10 hours 30 minutes
CONSUME BY PARTITION
